<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up - SanctumTools</title>
  <link rel="stylesheet" href="/css/design-system.css">
  <style>
    .auth-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--color-background) 0%, #f0e8dd 100%);
      padding: var(--spacing-lg);
    }

    .auth-card {
      background: var(--color-white);
      border-radius: var(--radius-2xl);
      padding: var(--spacing-2xl);
      max-width: 480px;
      width: 100%;
      box-shadow: 0 8px 32px rgba(153, 50, 168, 0.15);
    }

    .auth-header {
      text-align: center;
      margin-bottom: var(--spacing-xl);
    }

    .auth-logo {
      width: 60px;
      height: 60px;
      margin: 0 auto var(--spacing-md);
      background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-2xl);
      color: var(--color-text-inverse);
      font-weight: var(--font-weight-bold);
    }

    .auth-title {
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-bold);
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-xs);
    }

    .auth-subtitle {
      color: var(--color-text-muted);
      font-size: var(--font-size-base);
    }

    .auth-footer {
      text-align: center;
      margin-top: var(--spacing-xl);
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--color-gray-200);
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-xs);
      color: var(--color-primary);
      text-decoration: none;
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
      margin-bottom: var(--spacing-lg);
      transition: color var(--transition-fast);
    }

    .back-link:hover {
      color: var(--color-primary-dark);
    }

    .back-link svg {
      width: 16px;
      height: 16px;
    }

    .password-strength {
      margin-top: var(--spacing-xs);
      height: 4px;
      background: var(--color-gray-200);
      border-radius: var(--radius-full);
      overflow: hidden;
      transition: all var(--transition-normal);
    }

    .password-strength-bar {
      height: 100%;
      width: 0;
      transition: all var(--transition-normal);
      border-radius: var(--radius-full);
    }

    .password-strength-bar.weak {
      width: 33%;
      background: var(--color-crisis);
    }

    .password-strength-bar.medium {
      width: 66%;
      background: var(--color-warning);
    }

    .password-strength-bar.strong {
      width: 100%;
      background: var(--color-success);
    }

    .password-strength-text {
      font-size: var(--font-size-xs);
      margin-top: var(--spacing-xs);
      font-weight: var(--font-weight-medium);
    }

    .password-strength-text.weak {
      color: var(--color-crisis);
    }

    .password-strength-text.medium {
      color: var(--color-warning);
    }

    .password-strength-text.strong {
      color: var(--color-success);
    }

    .checkbox-group {
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-sm);
      margin: var(--spacing-lg) 0;
    }

    .checkbox-group input[type="checkbox"] {
      margin-top: 4px;
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: var(--color-primary);
    }

    .checkbox-group label {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      line-height: var(--line-height-normal);
      cursor: pointer;
    }

    .checkbox-group label a {
      color: var(--color-primary);
      text-decoration: none;
      font-weight: var(--font-weight-medium);
    }

    .checkbox-group label a:hover {
      text-decoration: underline;
    }

    .validation-error {
      color: var(--color-crisis);
      font-size: var(--font-size-sm);
      margin-top: var(--spacing-xs);
      display: none;
    }

    .validation-error.show {
      display: block;
    }

    .input-group.error .form-input {
      border-color: var(--color-crisis);
    }

    @media (max-width: 480px) {
      .auth-card {
        padding: var(--spacing-lg);
      }
    }
  </style>
</head>
<body>
  <div class="auth-container">
    <div class="auth-card animate-fade-in">
      <a href="/" class="back-link" aria-label="Back to homepage">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Back to home
      </a>

      <div class="auth-header">
        <div class="auth-logo" aria-hidden="true">S</div>
        <h1 class="auth-title">Create your account</h1>
        <p class="auth-subtitle">Join SanctumTools for secure mental health support</p>
      </div>

      <% if (error) { %>
        <div class="alert alert-danger" role="alert">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <%= error %>
        </div>
      <% } %>

      <form method="POST" id="signupForm" novalidate>
        <div class="input-group" id="emailGroup">
          <label for="email" class="input-group-label required">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            class="form-input"
            placeholder="you@example.com"
            required
            autofocus
            autocomplete="email"
            aria-label="Email address"
            aria-required="true"
            aria-describedby="emailError"
          >
          <span class="form-help">We'll send you a verification email</span>
          <span class="validation-error" id="emailError"></span>
        </div>

        <div class="input-group" id="passwordGroup">
          <label for="password" class="input-group-label required">Password</label>
          <input
            type="password"
            id="password"
            name="password"
            class="form-input"
            placeholder="••••••••"
            required
            autocomplete="new-password"
            aria-label="Password"
            aria-required="true"
            aria-describedby="passwordError passwordStrength"
          >
          <div class="password-strength">
            <div class="password-strength-bar" id="strengthBar"></div>
          </div>
          <div class="password-strength-text" id="passwordStrength"></div>
          <span class="form-help">Minimum 8 characters required</span>
          <span class="validation-error" id="passwordError"></span>
        </div>

        <div class="input-group" id="confirmPasswordGroup">
          <label for="confirmPassword" class="input-group-label required">Confirm Password</label>
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            class="form-input"
            placeholder="••••••••"
            required
            autocomplete="new-password"
            aria-label="Confirm password"
            aria-required="true"
            aria-describedby="confirmPasswordError"
          >
          <span class="validation-error" id="confirmPasswordError"></span>
        </div>

        <div class="checkbox-group">
          <input
            type="checkbox"
            id="termsAccepted"
            name="termsAccepted"
            required
            aria-label="Accept terms and conditions"
            aria-required="true"
          >
          <label for="termsAccepted">
            I agree to the <a href="/terms" target="_blank">Terms of Service</a> and <a href="/privacy" target="_blank">Privacy Policy</a>
          </label>
        </div>
        <span class="validation-error" id="termsError"></span>

        <button type="submit" class="btn btn-primary btn-full btn-lg">
          <span id="btn-text">Sign Up</span>
          <span id="btn-loader" class="loader" style="display: none;"></span>
        </button>
      </form>

      <div class="auth-footer">
        <p class="text-muted mb-sm">Already have an account?</p>
        <a href="/login" class="btn btn-secondary btn-full">Sign In</a>
      </div>
    </div>
  </div>

  <script>
    // Password strength checker
    function checkPasswordStrength(password) {
      if (!password) {
        return { strength: 'none', score: 0 };
      }

      let score = 0;

      // Length check
      if (password.length >= 8) score++;
      if (password.length >= 12) score++;

      // Complexity checks
      if (/[a-z]/.test(password)) score++;
      if (/[A-Z]/.test(password)) score++;
      if (/[0-9]/.test(password)) score++;
      if (/[^A-Za-z0-9]/.test(password)) score++;

      if (score <= 2) return { strength: 'weak', score };
      if (score <= 4) return { strength: 'medium', score };
      return { strength: 'strong', score };
    }

    // Update password strength indicator
    const passwordInput = document.getElementById('password');
    const strengthBar = document.getElementById('strengthBar');
    const strengthText = document.getElementById('passwordStrength');

    passwordInput.addEventListener('input', function() {
      const result = checkPasswordStrength(this.value);

      // Remove all strength classes
      strengthBar.className = 'password-strength-bar';
      strengthText.className = 'password-strength-text';

      if (result.strength !== 'none') {
        strengthBar.classList.add(result.strength);
        strengthText.classList.add(result.strength);

        if (result.strength === 'weak') {
          strengthText.textContent = 'Weak password';
        } else if (result.strength === 'medium') {
          strengthText.textContent = 'Medium password';
        } else {
          strengthText.textContent = 'Strong password';
        }
      } else {
        strengthText.textContent = '';
      }
    });

    // Form validation
    const form = document.getElementById('signupForm');
    const emailInput = document.getElementById('email');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const termsCheckbox = document.getElementById('termsAccepted');

    function showError(inputId, message) {
      const errorElement = document.getElementById(inputId + 'Error');
      const groupElement = document.getElementById(inputId + 'Group');

      if (errorElement) {
        errorElement.textContent = message;
        errorElement.classList.add('show');
      }

      if (groupElement) {
        groupElement.classList.add('error');
      }
    }

    function clearError(inputId) {
      const errorElement = document.getElementById(inputId + 'Error');
      const groupElement = document.getElementById(inputId + 'Group');

      if (errorElement) {
        errorElement.textContent = '';
        errorElement.classList.remove('show');
      }

      if (groupElement) {
        groupElement.classList.remove('error');
      }
    }

    // Real-time validation
    emailInput.addEventListener('blur', function() {
      if (!this.value) {
        showError('email', 'Email is required');
      } else if (!this.validity.valid) {
        showError('email', 'Please enter a valid email address');
      } else {
        clearError('email');
      }
    });

    emailInput.addEventListener('input', function() {
      if (this.value) clearError('email');
    });

    passwordInput.addEventListener('blur', function() {
      if (!this.value) {
        showError('password', 'Password is required');
      } else if (this.value.length < 8) {
        showError('password', 'Password must be at least 8 characters');
      } else {
        clearError('password');
      }
    });

    passwordInput.addEventListener('input', function() {
      if (this.value.length >= 8) clearError('password');
    });

    confirmPasswordInput.addEventListener('blur', function() {
      if (!this.value) {
        showError('confirmPassword', 'Please confirm your password');
      } else if (this.value !== passwordInput.value) {
        showError('confirmPassword', 'Passwords do not match');
      } else {
        clearError('confirmPassword');
      }
    });

    confirmPasswordInput.addEventListener('input', function() {
      if (this.value && this.value === passwordInput.value) {
        clearError('confirmPassword');
      }
    });

    // Form submission validation
    form.addEventListener('submit', function(e) {
      e.preventDefault();

      let isValid = true;

      // Clear all previous errors
      clearError('email');
      clearError('password');
      clearError('confirmPassword');

      const termsError = document.getElementById('termsError');
      if (termsError) {
        termsError.textContent = '';
        termsError.classList.remove('show');
      }

      // Validate email
      if (!emailInput.value) {
        showError('email', 'Email is required');
        isValid = false;
      } else if (!emailInput.validity.valid) {
        showError('email', 'Please enter a valid email address');
        isValid = false;
      }

      // Validate password
      if (!passwordInput.value) {
        showError('password', 'Password is required');
        isValid = false;
      } else if (passwordInput.value.length < 8) {
        showError('password', 'Password must be at least 8 characters');
        isValid = false;
      }

      // Validate password confirmation
      if (!confirmPasswordInput.value) {
        showError('confirmPassword', 'Please confirm your password');
        isValid = false;
      } else if (confirmPasswordInput.value !== passwordInput.value) {
        showError('confirmPassword', 'Passwords do not match');
        isValid = false;
      }

      // Validate terms acceptance
      if (!termsCheckbox.checked) {
        if (termsError) {
          termsError.textContent = 'You must accept the Terms of Service and Privacy Policy';
          termsError.classList.add('show');
        }
        isValid = false;
      }

      // If validation passes, submit the form
      if (isValid) {
        const button = this.querySelector('button[type="submit"]');
        const btnText = document.getElementById('btn-text');
        const btnLoader = document.getElementById('btn-loader');

        button.disabled = true;
        btnText.style.display = 'none';
        btnLoader.style.display = 'inline-block';

        // Submit the form
        this.submit();
      }
    });
  </script>
</body>
</html>