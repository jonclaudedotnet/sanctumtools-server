# AWS Infrastructure Setup for SanctumTools
## Date: November 7, 2025

### EC2 Instance Details
- **Instance ID**: i-0c841e020508e7227
- **Public IP**: 13.218.249.157
- **Hostname**: ec2-13-218-249-157.compute-1.amazonaws.com
- **Region**: us-east-1
- **Application**: Node.js server on port 3000

---

## 1. ROUTE53 DNS CONFIGURATION

### DNS Records to Create
```
Domain                      Type    Value               TTL
--------------------------------------------------------------
sanctumtools.com           A       13.218.249.157      300
www.sanctumtools.com       A       13.218.249.157      300
mr.sanctumtools.com        A       13.218.249.157      300
```

### Setup Steps:
1. Navigate to AWS Console → Route53
2. Select hosted zone: sanctumtools.com
3. Click "Create record"
4. For each domain:
   - Record name: (leave blank for root, or www/mr for subdomains)
   - Record type: A - IPv4 address
   - Value: 13.218.249.157
   - TTL: 300 seconds
   - Routing policy: Simple routing
5. Click "Create records"

### Status Tracking:
- [ ] sanctumtools.com A record created
- [ ] www.sanctumtools.com A record created
- [ ] mr.sanctumtools.com A record created
- [ ] DNS propagation started (check with: `nslookup sanctumtools.com`)

---

## 2. AWS CERTIFICATE MANAGER (ACM) SETUP

### Certificate Configuration
```
Primary Domain: sanctumtools.com
Additional Names: *.sanctumtools.com
Validation Method: DNS validation
```

### Setup Steps:
1. Navigate to AWS Console → Certificate Manager
2. Click "Request certificate" → "Request a public certificate"
3. Domain names:
   - sanctumtools.com
   - *.sanctumtools.com
4. Select "DNS validation"
5. Add tags (optional):
   - Environment: Production
   - Project: SanctumTools
6. Review and request

### DNS Validation Records:
```
CNAME Records for Validation (will be auto-generated by ACM):
_<random-string>.sanctumtools.com → _<validation-string>.acm-validations.aws.
```

### Status Tracking:
- [ ] Certificate requested
- [ ] CNAME validation records created in Route53
- [ ] Certificate status: Pending validation
- [ ] Certificate status: Issued (5-10 minutes)
- [ ] Certificate ARN: arn:aws:acm:us-east-1:XXXXXXXXXXXX:certificate/XXXXXX

---

## 3. APPLICATION LOAD BALANCER (ALB) CONFIGURATION

### ALB Specifications
```yaml
Name: sanctumtools-alb
Type: Application Load Balancer
Scheme: Internet-facing
IP address type: IPv4
```

### Network Configuration
```yaml
VPC: Default VPC
Availability Zones:
  - us-east-1a
  - us-east-1b (minimum 2 required)
Subnets: Auto-selected public subnets
```

### Security Group for ALB
```yaml
Name: sanctumtools-alb-sg
Inbound Rules:
  - Type: HTTP, Port: 80, Source: 0.0.0.0/0
  - Type: HTTPS, Port: 443, Source: 0.0.0.0/0
Outbound Rules:
  - Type: All traffic, Destination: 0.0.0.0/0
```

### Target Group Configuration
```yaml
Name: sanctumtools-targets
Protocol: HTTP
Port: 3000
VPC: Default VPC
Health Check Settings:
  Protocol: HTTP
  Path: /
  Port: traffic-port
  Healthy threshold: 2
  Unhealthy threshold: 2
  Timeout: 5 seconds
  Interval: 30 seconds
  Success codes: 200
```

### Listener Configuration
```yaml
Listener 1 (HTTP):
  Port: 80
  Protocol: HTTP
  Default Action: Redirect to HTTPS
    - Port: 443
    - Status code: 301

Listener 2 (HTTPS):
  Port: 443
  Protocol: HTTPS
  SSL Certificate: Select from ACM
  Default Action: Forward to target group
    - Target group: sanctumtools-targets
```

### Setup Steps:
1. Navigate to EC2 → Load Balancers
2. Click "Create Load Balancer" → "Application Load Balancer"
3. Basic Configuration:
   - Name: sanctumtools-alb
   - Scheme: Internet-facing
   - IP address type: IPv4
4. Network mapping:
   - VPC: Default
   - Select at least 2 availability zones
5. Security groups:
   - Create new: sanctumtools-alb-sg
   - Add inbound rules for 80 and 443
6. Listeners and routing:
   - Add listeners for ports 80 and 443
   - Create target group: sanctumtools-targets
7. Register targets:
   - Add instance: i-0c841e020508e7227
   - Port: 3000
8. Review and create

### Status Tracking:
- [ ] ALB created
- [ ] Target group created
- [ ] Instance registered and healthy
- [ ] HTTP listener configured (redirect to HTTPS)
- [ ] HTTPS listener configured with ACM certificate
- [ ] ALB DNS name: sanctumtools-alb-XXXXXXXXXX.us-east-1.elb.amazonaws.com

---

## 4. EC2 SECURITY GROUP UPDATES

### Current Security Group Rules (BEFORE)
```yaml
Inbound:
  - SSH (22): Your IP
  - HTTP (80): 0.0.0.0/0
  - Custom TCP (3000): 0.0.0.0/0
```

### Updated Security Group Rules (AFTER)
```yaml
Inbound:
  - SSH (22): Your IP (keep for management)
  - Custom TCP (3000): sg-XXXXXX (ALB security group only)

Remove:
  - HTTP (80): 0.0.0.0/0 (handled by ALB now)
  - Custom TCP (3000): 0.0.0.0/0 (restrict to ALB only)
```

### Update Steps:
1. Navigate to EC2 → Security Groups
2. Select the instance's security group
3. Edit inbound rules:
   - Remove HTTP (80) from 0.0.0.0/0
   - Change Custom TCP (3000) source from 0.0.0.0/0 to ALB security group
   - Keep SSH (22) for management
4. Save rules

### Status Tracking:
- [ ] Identified current security group
- [ ] Removed public access to port 3000
- [ ] Added ALB security group access to port 3000
- [ ] Removed redundant port 80 rule
- [ ] Verified ALB can reach instance

---

## 5. UPDATE ROUTE53 RECORDS TO POINT TO ALB

### Final DNS Configuration (After ALB is ready)
```
Domain                      Type    Value                                           TTL
------------------------------------------------------------------------------------------
sanctumtools.com           A       ALIAS → sanctumtools-alb-XXXXX.elb.amazonaws.com   N/A
www.sanctumtools.com       A       ALIAS → sanctumtools-alb-XXXXX.elb.amazonaws.com   N/A
mr.sanctumtools.com        A       ALIAS → sanctumtools-alb-XXXXX.elb.amazonaws.com   N/A
```

### Update Steps:
1. Navigate to Route53 → Hosted zones → sanctumtools.com
2. Edit each A record
3. Change from simple routing to alias
4. Select:
   - Alias to: Application and Classic Load Balancer
   - Region: us-east-1
   - Load balancer: sanctumtools-alb
5. Save changes

---

## COST ANALYSIS

### Estimated Monthly Costs
```
Service                     Cost/Month      Notes
---------------------------------------------------
Route53 Hosted Zone         $0.50          Per hosted zone
Route53 Queries             $0.40          Per million queries (estimated)
ACM SSL Certificate         $0.00          Free for AWS resources
Application Load Balancer   $16.20         $0.0225 per hour
ALB Data Processing         $3.60          $0.008 per GB (estimated 450GB)
---------------------------------------------------
TOTAL                       ~$20.70/month
```

### Cost Optimization Options:
1. **Use CloudFront** instead of ALB for static content ($8-12/month)
2. **Use Elastic IP** with Nginx on EC2 (no ALB cost, but less scalable)
3. **Time-based scaling** for ALB during low-traffic hours

---

## TESTING & VALIDATION

### DNS Testing Commands
```bash
# Test DNS resolution
nslookup sanctumtools.com
nslookup www.sanctumtools.com
nslookup mr.sanctumtools.com

# Test with specific DNS server
nslookup sanctumtools.com 8.8.8.8

# Check DNS propagation
dig sanctumtools.com
```

### SSL Certificate Testing
```bash
# Test SSL certificate
openssl s_client -connect sanctumtools.com:443 -servername sanctumtools.com

# Check certificate details
curl -vI https://sanctumtools.com
```

### Application Testing
```bash
# Test HTTP redirect
curl -I http://sanctumtools.com

# Test HTTPS
curl -I https://sanctumtools.com

# Test subdomains
curl -I https://www.sanctumtools.com
curl -I https://mr.sanctumtools.com
```

---

## MONITORING & ALERTS

### CloudWatch Metrics to Monitor
- ALB Request Count
- Target Response Time
- HTTP 4xx/5xx errors
- Healthy Host Count
- SSL Certificate Expiration

### Recommended Alarms
```yaml
UnhealthyTargets:
  Metric: UnHealthyHostCount
  Threshold: > 0
  Period: 5 minutes

HighLatency:
  Metric: TargetResponseTime
  Threshold: > 1 second
  Period: 5 minutes

High4xxErrors:
  Metric: HTTPCode_Target_4XX_Count
  Threshold: > 100
  Period: 5 minutes
```

---

## ROLLBACK PLAN

If issues occur:
1. **Immediate**: Update Route53 to point back to EC2 IP (13.218.249.157)
2. **Restore security groups**: Re-enable port 3000 public access
3. **Debug ALB**: Check target health, security groups, and listeners
4. **Certificate issues**: Verify ACM certificate is validated and attached

---

## COMPLETION CHECKLIST

### Phase 1: DNS Setup
- [ ] Route53 A records created
- [ ] DNS propagation confirmed
- [ ] Basic connectivity test passed

### Phase 2: SSL Certificate
- [ ] ACM certificate requested
- [ ] DNS validation completed
- [ ] Certificate issued and active

### Phase 3: Load Balancer
- [ ] ALB created and configured
- [ ] Target group healthy
- [ ] HTTP to HTTPS redirect working
- [ ] SSL termination working

### Phase 4: Security
- [ ] Security groups updated
- [ ] Port 3000 restricted to ALB only
- [ ] SSH access maintained

### Phase 5: Final Testing
- [ ] All domains resolving to ALB
- [ ] HTTPS working on all domains
- [ ] Application accessible and functional
- [ ] Monitoring configured

---

## NOTES & OBSERVATIONS

- **DNS Propagation**: May take up to 48 hours globally, but usually 5-10 minutes for Route53
- **Certificate Validation**: Usually completes within 5-10 minutes with DNS validation
- **ALB Warm-up**: New ALB may take 2-3 minutes to fully initialize
- **Health Checks**: Ensure your application responds with 200 OK on the root path

---

## CONTACT & SUPPORT

For AWS Support issues:
- AWS Support Center: https://console.aws.amazon.com/support/
- AWS Status: https://status.aws.amazon.com/

Last Updated: November 7, 2025